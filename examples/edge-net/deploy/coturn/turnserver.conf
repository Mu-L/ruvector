# Edge-Net coturn TURN Server Configuration
# https://github.com/coturn/coturn/wiki/turnserver
#
# This configuration is optimized for Edge-Net P2P WebRTC connections
# with support for symmetric NAT traversal.

# =====================================================
# NETWORK CONFIGURATION
# =====================================================

# STUN/TURN listening port (UDP and TCP)
listening-port=3478

# TURN over TLS/DTLS listening port
tls-listening-port=5349

# Alternative listening port (for firewall traversal)
alt-listening-port=3479

# Relay port range for media
min-port=49152
max-port=65535

# External IP address (REQUIRED for NAT traversal)
# Uncomment and set your public IP, or use detection
# external-ip=YOUR_PUBLIC_IP
# external-ip=YOUR_PUBLIC_IP/YOUR_PRIVATE_IP

# Listening interface (0.0.0.0 = all interfaces)
listening-ip=0.0.0.0

# Relay interface
relay-ip=0.0.0.0

# =====================================================
# AUTHENTICATION
# =====================================================

# Realm for TURN authentication
realm=edge-net.local

# Enable long-term credential mechanism (recommended)
lt-cred-mech

# Static user credentials (for simple deployments)
# Format: user=username:password
# user=edgenet:changeme

# For production, use REST API for ephemeral credentials:
# use-auth-secret
# static-auth-secret=YOUR_SHARED_SECRET

# =====================================================
# SECURITY
# =====================================================

# TLS/SSL certificate and key (for TURNS)
# cert=/etc/coturn/certs/turn.crt
# pkey=/etc/coturn/certs/turn.key

# Disable weak ciphers
# cipher-list=ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256

# Enable fingerprinting (RFC 5780)
fingerprint

# Prevent relay to multicast addresses
no-multicast-peers

# Prevent relay to loopback
no-loopback-peers

# Deny relay to specific CIDR ranges (private networks)
# denied-peer-ip=10.0.0.0-10.255.255.255
# denied-peer-ip=172.16.0.0-172.31.255.255
# denied-peer-ip=192.168.0.0-192.168.255.255

# Stale nonce timeout (seconds)
stale-nonce=600

# =====================================================
# RATE LIMITING & QUOTAS
# =====================================================

# Total bandwidth limit (0 = unlimited)
max-bps=0

# Per-session bandwidth limit
# bps-capacity=0

# Total relay sessions quota (0 = unlimited)
total-quota=0

# Per-user relay sessions quota (0 = unlimited)
user-quota=0

# =====================================================
# PERFORMANCE
# =====================================================

# Number of relay threads (0 = auto-detect CPU cores)
relay-threads=0

# Verbose logging
verbose

# Log to stdout (for Docker)
log-file=stdout

# Disable CLI (not needed in containerized deployment)
no-cli

# =====================================================
# STUN OPTIONS
# =====================================================

# Disable old STUN behavior (use RFC 5780)
no-stun-backward-compatibility

# Only respond with origin (security)
response-origin-only-with-rfc5780

# =====================================================
# REDIS CONFIGURATION (for clustering)
# =====================================================
# Uncomment for horizontal scaling with Redis

# redis-userdb="ip=127.0.0.1 dbname=0 password=redis_password connect_timeout=30"
# redis-statsdb="ip=127.0.0.1 dbname=1 password=redis_password connect_timeout=30"

# =====================================================
# PROMETHEUS METRICS (optional)
# =====================================================

# Enable Prometheus metrics endpoint
# prometheus

# =====================================================
# MOBILITY (for mobile clients)
# =====================================================

# Enable TURN mobility (RFC 8016)
mobility

# =====================================================
# CHANNEL BINDING
# =====================================================

# Channel binding lifetime (default 600 seconds)
# channel-lifetime=600

# Permissions lifetime (default 300 seconds)
# permission-lifetime=300
